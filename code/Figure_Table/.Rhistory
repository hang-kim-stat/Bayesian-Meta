rm(list = ls())
load("../../data/SimulationData_1.RData")
p_mu = length(true_mu)
Method_list = c("1_Benchmark","2_IPD-AD","3_IPD-AD-pooled","4_IPD_only")
Table1 = NULL
for (i_method in 1:length(Method_list)){
PostMean = PostVar = isCover1 = isCover2 = array(0,c(n_rep,2*p_mu))
for (rep_no in 1:n_rep){
load(paste0("../../output/Simulation_1/",Method_list[i_method],"/RData/rep_",rep_no,".RData"))
PostMean[rep_no,1:p_mu] = apply(posterior_mu,2,mean)
PostVar[rep_no,1:p_mu] = apply(posterior_mu,2,var)
for (i_var in 1:p_mu){
Post2_5 = quantile(posterior_mu[,i_var],probs=0.025)
Post97_5 = quantile(posterior_mu[,i_var],probs=0.975)
isCover1[rep_no,i_var] = (Post2_5<=true_mu[i_var]) && (true_mu[i_var]<=Post97_5)
} # for (i_var in 1:p_mu)
PostMean[rep_no,p_mu+(1:p_mu)] = apply(posterior_Sigma_theta,2,mean)
PostVar[rep_no,p_mu+(1:p_mu)] = apply(posterior_Sigma_theta,2,var)
for (i_var in 1:p_mu){
Post2_5 = quantile(posterior_Sigma_theta[,i_var],probs=0.025)
Post97_5 = quantile(posterior_Sigma_theta[,i_var],probs=0.975)
isCover1[rep_no,p_mu+i_var] = (Post2_5<=true_Sigma_theta[i_var]) && (true_Sigma_theta[i_var]<=Post97_5)
} # for (i_var in 1:p_mu)
} # for (rep_no in 1:n_rep)
RESULT = array(0,c(8,4))
dimnames(RESULT)[[1]] = c("mu1","mu2","mu3","mu4","Sig11","Sig22","Sig33","Sig44")
dimnames(RESULT)[[2]] = c("Est","Bias","MSE","CredCov95")
RESULT[,"Est"] = apply(PostMean,2,mean)
RESULT[,"Bias"] = apply(PostMean,2,mean)-c(true_mu,true_Sigma_theta)
for (i_var in 1:p_theta){
RESULT[i_var,"MSE"] = mean((PostMean[,i_var]-true_mu[i_var])^2)
}
for (i_var in 1:p_theta){
RESULT[p_theta+i_var,"MSE"] = mean((PostMean[,i_var]-true_Sigma_theta[i_var])^2)
}
RESULT[,"CredCov95"] = apply(isCover1,2,mean)
Table1 = cbind(Table1,RESULT)
} # for (i_method in 1:4)
##############################
write.csv(Table1,file="../../output/Figure_Table/Supplement_Table4.csv")
setwd("~/Dropbox/44d_ProfMOYunxiang_Integrate_External_Info/Bayesian-Meta/code/Figure_Table")
rm(list = ls())
load("../../data/SimulationData_2.RData")
p_mu = length(true_mu)
Method_list = c("1_Benchmark","2_IPD-AD","3_IPD-AD-pooled","4_IPD_only")
Table5 = NULL
for (i_method in 1:length(Method_list)){
PostMean = PostVar = isCover1 = isCover2 = array(0,c(n_rep,2*p_mu))
for (rep_no in 1:n_rep){
load(paste0("../../output/Simulation_2/",Method_list[i_method],"/RData/rep_",rep_no,".RData"))
PostMean[rep_no,1:p_mu] = apply(posterior_mu,2,mean)
PostVar[rep_no,1:p_mu] = apply(posterior_mu,2,var)
for (i_var in 1:p_mu){
Post2_5 = quantile(posterior_mu[,i_var],probs=0.025)
Post97_5 = quantile(posterior_mu[,i_var],probs=0.975)
isCover1[rep_no,i_var] = (Post2_5<=true_mu[i_var]) && (true_mu[i_var]<=Post97_5)
} # for (i_var in 1:p_mu)
PostMean[rep_no,p_mu+(1:p_mu)] = apply(posterior_Sigma_theta,2,mean)
PostVar[rep_no,p_mu+(1:p_mu)] = apply(posterior_Sigma_theta,2,var)
for (i_var in 1:p_mu){
Post2_5 = quantile(posterior_Sigma_theta[,i_var],probs=0.025)
Post97_5 = quantile(posterior_Sigma_theta[,i_var],probs=0.975)
isCover1[rep_no,p_mu+i_var] = (Post2_5<=true_Sigma_theta[i_var]) && (true_Sigma_theta[i_var]<=Post97_5)
} # for (i_var in 1:p_mu)
} # for (rep_no in 1:n_rep)
RESULT = array(0,c(8,4))
dimnames(RESULT)[[1]] = c("mu1","mu2","mu3","mu4","Sig11","Sig22","Sig33","Sig44")
dimnames(RESULT)[[2]] = c("Est","Bias","MSE","CredCov95")
RESULT[,"Est"] = apply(PostMean,2,mean)
RESULT[,"Bias"] = apply(PostMean,2,mean)-c(true_mu,true_Sigma_theta)
for (i_var in 1:p_theta){
RESULT[i_var,"MSE"] = mean((PostMean[,i_var]-true_mu[i_var])^2)
}
for (i_var in 1:p_theta){
RESULT[p_theta+i_var,"MSE"] = mean((PostMean[,i_var]-true_Sigma_theta[i_var])^2)
}
RESULT[,"CredCov95"] = apply(isCover1,2,mean)
Table5 = cbind(Table5,RESULT)
} # for (i_method in 1:4)
##############################
write.csv(Table5,file="../../output/Figure_Table/Supplement_Table5.csv")
rm(list=ls())
# Set text size
SIZE_title.y = 18 ; SIZE_title.x = 16 ; SIZE_text.y = 16 ; SIZE_text.x = 18 ; SIZE_title = 22 ; SIZE_b = 10
# data1 = read.csv("../../output/Figure_Table/Supplement_Table4.csv", stringsAsFactors = FALSE)
data1 = read.csv("../../output/Figure_Table/Supplement_Table4.csv")
data1
Table4_figure = array(NA,c(16,5))
colnames(Table4_figure) = c("Method","Parameter","Bias","MSE","Coverage")
Table4_figure[,1] = rep(c("Benchmark","IPD-AD","IPD-AD(pooled)","IPD only"),4)
Table4_figure[,2] = rep(c("mu1","mu2","mu3","mu4"),each=4)
for (i_method in 1:4){
SEQ1 = c(0,4,8,12)+i_method
SEQ2 = (2:4)+(i_method-1)*4
Table4_figure[SEQ1,3:5] = Table4[1:4,SEQ2]
} #
Table4 = read.csv("../../output/Figure_Table/Supplement_Table4.csv")
Table4_figure = array(NA,c(16,5))
colnames(Table4_figure) = c("Method","Parameter","Bias","MSE","Coverage")
Table4_figure[,1] = rep(c("Benchmark","IPD-AD","IPD-AD(pooled)","IPD only"),4)
Table4_figure[,2] = rep(c("mu1","mu2","mu3","mu4"),each=4)
for (i_method in 1:4){
SEQ1 = c(0,4,8,12)+i_method
SEQ2 = (2:4)+(i_method-1)*4
Table4_figure[SEQ1,3:5] = Table4[1:4,SEQ2]
} #
Table4_figure
Table4_figure = array(NA,c(16,5))
colnames(Table4_figure) = c("Method","Parameter","Bias","MSE","Coverage")
Table4_figure
Table4_figure[,1] = rep(c("Benchmark","IPD-AD","IPD-AD(pooled)","IPD only"),4)
Table4_figure[,2] = rep(c("mu1","mu2","mu3","mu4"),each=4)
Table4_figure
Table4
Table4 = read.csv("../../output/Figure_Table/Supplement_Table4.csv", stringsAsFactors = FALSE)
Table4_figure = array(NA,c(16,5))
colnames(Table4_figure) = c("Method","Parameter","Bias","MSE","Coverage")
Table4_figure[,1] = rep(c("Benchmark","IPD-AD","IPD-AD(pooled)","IPD only"),4)
Table4_figure[,2] = rep(c("mu1","mu2","mu3","mu4"),each=4)
for (i_method in 1:4){
SEQ1 = c(0,4,8,12)+i_method
SEQ2 = (2:4)+(i_method-1)*4
Table4_figure[SEQ1,3:5] = Table4[1:4,SEQ2]
} #
Table4_figure
Table4[1:4,SEQ2]
as.numeric(Table4[1:4,SEQ2])
length(SEQ1)
length(SEQ2)
as.table(Table4[1:4,SEQ2])
Table4[1:4,SEQ2]
class(Table4[1:4,SEQ2])
Table4_figure = array(NA,c(16,5))
colnames(Table4_figure) = c("Method","Parameter","Bias","MSE","Coverage")
Table4_figure[,1] = rep(c("Benchmark","IPD-AD","IPD-AD(pooled)","IPD only"),4)
Table4_figure[,2] = rep(c("mu1","mu2","mu3","mu4"),each=4)
i_method = 1
SEQ1 = c(0,4,8,12)+i_method
SEQ2 = (2:4)+(i_method-1)*4
Table4_figure[SEQ1,3:5]
as.table(Table4[1:4,SEQ2])
Table4[1:4,SEQ2]
class(Table4[1:4,SEQ2])
class(Table4_figure[SEQ1,3:5])
as.numeric(Table4[1:4,SEQ2])
as.matrix(Table4[1:4,SEQ2])
Table4_figure[SEQ1,3:5] = as.matrix(Table4[1:4,SEQ2])
Table4_figure
Table4 = read.csv("../../output/Figure_Table/Supplement_Table4.csv")
Table4_figure = array(NA,c(16,5))
colnames(Table4_figure) = c("Method","Parameter","Bias","MSE","Coverage")
Table4_figure[,1] = rep(c("Benchmark","IPD-AD","IPD-AD(pooled)","IPD only"),4)
Table4_figure[,2] = rep(c("mu1","mu2","mu3","mu4"),each=4)
for (i_method in 1:4){
SEQ1 = c(0,4,8,12)+i_method
SEQ2 = (2:4)+(i_method-1)*4
Table4_figure[SEQ1,3:5] = as.matrix(Table4[1:4,SEQ2])
} #
Table4_figure
# Set the order of the Method variable
Table4_figure$Method <- factor(Table4_figure$Method, levels = c("Benchmark", "IPD-AD", "IPD-AD(pooled)", "IPD only"), labels = c("Bench\nmark", "IPD-AD", "IPD-AD\n(pooled)", "IPD\nonly") )
Table4_figure
Table4_figure$Method
# Set the order of the Method variable
Table4_figure[,"Method"] <- factor(Table4_figure$Method, levels = c("Benchmark", "IPD-AD", "IPD-AD(pooled)", "IPD only"), labels = c("Bench\nmark", "IPD-AD", "IPD-AD\n(pooled)", "IPD\nonly") )
# Set the order of the Method variable
Table4_figure[,"Method"] <- factor(Table4_figure[,"Method"], levels = c("Benchmark", "IPD-AD", "IPD-AD(pooled)", "IPD only"), labels = c("Bench\nmark", "IPD-AD", "IPD-AD\n(pooled)", "IPD\nonly") )
Table4_figure
# Plot for Bias with legend
plot_bias1 <- ggplot(Table4_figure, aes(x = Method, y = Bias, shape = Parameter, color = Parameter)) +
geom_point(size = 5) +
geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
labs(title = "Bias", x = "", y = "Bias") +
scale_shape_manual(values = c(1, 2, 15, 4), labels = greek_labels) +
scale_color_manual(values = c("blue", "brown", "red", "purple"), labels = greek_labels) +
scale_y_continuous(limits = c(-0.1, 0.1), labels = number_format(accuracy = 0.01)) +
theme(
plot.title = element_text(size = SIZE_title, face = "bold", hjust = 0.5, margin = margin(b = SIZE_b)),
axis.title.x = element_blank(),
# axis.title.y = element_text(size = 24, face = "bold", margin = margin(r = 20)),
# axis.title.y = element_text(size = SIZE_title.y),
axis.title.y = element_blank(),
# axis.text.x = element_blank(),
axis.text.x = element_text(size = SIZE_text.x),
axis.text.y = element_text(size = SIZE_text.y),
legend.position = "none"
)
# Load necessary libraries
library(ggplot2)
# Plot for Bias with legend
plot_bias1 <- ggplot(Table4_figure, aes(x = Method, y = Bias, shape = Parameter, color = Parameter)) +
geom_point(size = 5) +
geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
labs(title = "Bias", x = "", y = "Bias") +
scale_shape_manual(values = c(1, 2, 15, 4), labels = greek_labels) +
scale_color_manual(values = c("blue", "brown", "red", "purple"), labels = greek_labels) +
scale_y_continuous(limits = c(-0.1, 0.1), labels = number_format(accuracy = 0.01)) +
theme(
plot.title = element_text(size = SIZE_title, face = "bold", hjust = 0.5, margin = margin(b = SIZE_b)),
axis.title.x = element_blank(),
# axis.title.y = element_text(size = 24, face = "bold", margin = margin(r = 20)),
# axis.title.y = element_text(size = SIZE_title.y),
axis.title.y = element_blank(),
# axis.text.x = element_blank(),
axis.text.x = element_text(size = SIZE_text.x),
axis.text.y = element_text(size = SIZE_text.y),
legend.position = "none"
)
# Define Greek labels for the legend
greek_labels <- c(expression(mu[0]), expression(mu[1]), expression(mu[2]), expression(mu[12]))
# Plot for Bias with legend
plot_bias1 <- ggplot(Table4_figure, aes(x = Method, y = Bias, shape = Parameter, color = Parameter)) +
geom_point(size = 5) +
geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
labs(title = "Bias", x = "", y = "Bias") +
scale_shape_manual(values = c(1, 2, 15, 4), labels = greek_labels) +
scale_color_manual(values = c("blue", "brown", "red", "purple"), labels = greek_labels) +
scale_y_continuous(limits = c(-0.1, 0.1), labels = number_format(accuracy = 0.01)) +
theme(
plot.title = element_text(size = SIZE_title, face = "bold", hjust = 0.5, margin = margin(b = SIZE_b)),
axis.title.x = element_blank(),
# axis.title.y = element_text(size = 24, face = "bold", margin = margin(r = 20)),
# axis.title.y = element_text(size = SIZE_title.y),
axis.title.y = element_blank(),
# axis.text.x = element_blank(),
axis.text.x = element_text(size = SIZE_text.x),
axis.text.y = element_text(size = SIZE_text.y),
legend.position = "none"
)
# Load necessary libraries
library(ggplot2)
library(patchwork) # For arranging plots side by side
library(dplyr)
library(tidyr)
library(scales)
# Plot for Bias with legend
plot_bias1 <- ggplot(Table4_figure, aes(x = Method, y = Bias, shape = Parameter, color = Parameter)) +
geom_point(size = 5) +
geom_hline(yintercept = 0, linetype = "dashed", color = "black") +
labs(title = "Bias", x = "", y = "Bias") +
scale_shape_manual(values = c(1, 2, 15, 4), labels = greek_labels) +
scale_color_manual(values = c("blue", "brown", "red", "purple"), labels = greek_labels) +
scale_y_continuous(limits = c(-0.1, 0.1), labels = number_format(accuracy = 0.01)) +
theme(
plot.title = element_text(size = SIZE_title, face = "bold", hjust = 0.5, margin = margin(b = SIZE_b)),
axis.title.x = element_blank(),
# axis.title.y = element_text(size = 24, face = "bold", margin = margin(r = 20)),
# axis.title.y = element_text(size = SIZE_title.y),
axis.title.y = element_blank(),
# axis.text.x = element_blank(),
axis.text.x = element_text(size = SIZE_text.x),
axis.text.y = element_text(size = SIZE_text.y),
legend.position = "none"
)
# Plot for MSE with connecting lines, without legend, and with adjusted text size
plot_mse1 <- ggplot(Table4_figure, aes(x = Method, y = MSE, group = Parameter, shape = Parameter, color = Parameter)) +
geom_point(size = 5) +
geom_line(linetype = "dashed") +
labs(title = "MSE", x = "", y = "MSE") +
scale_shape_manual(values = c(1, 2, 15, 4), labels = greek_labels) +
scale_color_manual(values = c("blue", "brown", "red", "purple"), labels = greek_labels) +
scale_y_continuous(limits = c(0, 0.13)) +
theme(
plot.title = element_text(size = SIZE_title, face = "bold", hjust = 0.5, margin = margin(b = SIZE_b)),
legend.position = "none",
axis.title.x = element_blank(),
# axis.title.y = element_text(size = 24, face = "bold", margin = margin(r = 20)),
axis.title.y = element_blank(),
axis.text.x = element_text(size = SIZE_text.x),
axis.text.y = element_text(size = SIZE_text.y),
legend.text = element_text(size = 16)
)
# Plot for 95% Coverage without legend and with adjusted text size
plot_95cover1 <- ggplot(Table4_figure, aes(x = Method, y = Coverage, shape = Parameter, color = Parameter)) +
geom_point(size = 5) +
geom_hline(yintercept = 0.95, linetype = "dashed", color = "black") +
labs(title = "95% C.I. Coverage", x = "", y = "95% C.I. Coverage") +
scale_shape_manual(values = c(1, 2, 15, 4), labels = greek_labels) +
scale_color_manual(values = c("blue", "brown", "red", "purple"), labels = greek_labels) +
scale_y_continuous(limits = c(0.9, 1.0), labels = number_format(accuracy = 0.01)) +
theme(
plot.title = element_text(size = SIZE_title, face = "bold", hjust = 0.5, margin = margin(b = SIZE_b)),
axis.title.x = element_blank(),
# axis.title.y = element_text(size = 24, face = "bold", margin = margin(r = 20)),
axis.title.y = element_blank(),
axis.text.x = element_text(size = SIZE_text.x),
axis.text.y = element_text(size = SIZE_text.y),
legend.position = "none"
)
